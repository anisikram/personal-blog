---
import cvData from '../data/cv.json';

function formatDate(dateString) {
  if (!dateString) return 'Présent';
  const date = new Date(dateString);
  return date.toLocaleDateString('fr-FR', { year: 'numeric', month: 'short' });
}
---

<div class="card bg-base-100 shadow-xl p-6">
  <h2 class="text-2xl font-bold mb-8 text-center">Expérience Professionnelle</h2>
  <ul class="timeline timeline-vertical">
    {cvData.map((experience, index) => (
      <li>
        {index > 0 && <hr />}
        <div class={`timeline-${index % 2 === 0 ? 'start' : 'end'} timeline-box flex min-h-[110px] w-full max-w-[320px] flex-col justify-between gap-3`}>
          {experience.website ? (
            <a
              href={experience.website}
              target="_blank"
              rel="noopener noreferrer"
              class="group flex items-center gap-4"
            >
              {experience.logo ? (
                <div class="inline-flex h-14 w-14 items-center justify-center rounded-full border border-base-200 bg-base-200 p-2 transition group-hover:border-primary/70">
                  <img src={experience.logo} alt={`Logo ${experience.company}`} class="h-full w-full object-contain" loading="lazy" />
                </div>
              ) : (
                <div class="inline-flex h-14 w-14 items-center justify-center rounded-full bg-base-200 text-lg font-semibold text-primary">
                  {experience.company.slice(0, 2)}
                </div>
              )}
              <div>
                <p class="text-lg font-semibold text-base-content group-hover:text-primary">{experience.company}</p>
                <p class="text-sm text-base-content/70">{experience.title}</p>
              </div>
              <span class="sr-only">Accéder au site de {experience.company}</span>
            </a>
          ) : (
            <div class="flex items-center gap-4">
              <div class="inline-flex h-14 w-14 items-center justify-center rounded-full bg-base-200 text-lg font-semibold text-primary">
                {experience.company.slice(0, 2)}
              </div>
              <div>
                <p class="text-lg font-semibold text-base-content">{experience.company}</p>
                <p class="text-sm text-base-content/70">{experience.title}</p>
              </div>
            </div>
          )}
          <p class="text-sm text-gray-500">
            {formatDate(experience.startDate)} — {formatDate(experience.endDate)}
          </p>
        </div>
        <div class="timeline-middle">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-primary"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
        </div>
        {index < cvData.length - 1 && <hr />}
      </li>
    ))}
  </ul>
</div>
